# Модуль Color Picker Webview

Клиентская часть расширения Color Picker для VS Code, отвечающая за визуальный интерфейс выбора цветов.

## Глобальные переменные

### `currentColor`
```javascript
let currentColor = 'rgba(255, 0, 0, 1)';
```
Текущий выбранный цвет в формате RGBA.

### Параметры HSV
```javascript
window.S = 0;       // Насыщенность (0-100%)
window.V = 100;     // Яркость (0-100%)
window.H = 0;       // Цветовой тон (0-360°)
window.opasity = 1; // Прозрачность (0-1)
```
Глобальные переменные для хранения параметров цвета в формате HSV.

### Константы управления
```javascript
startPadding = 3;   // Отступ для кружков от краев канваса
timeoutTime = 50;   // Задержка для throttle обновлений (мс)
```

## Функции инициализации

### `DOMContentLoaded`
```javascript
document.addEventListener('DOMContentLoaded', function () {
    HueSelection();
    SaturationAndValueSelection(`rgba(${HueToRgb(0, 100, 100, 1)})`);
    opasityCanvas();
    updateColorDisplay();
    vscode.postMessage({ type: 'getSavedColors' });
});
```
Инициализирует все компоненты color picker'а при загрузке DOM.

### `window resize`
```javascript
window.addEventListener("resize", () => {
    HueSelection();
    SaturationAndValueSelection(`rgba(${HueToRgb(window.H, 100, 100, 1)})`);
    opasityCanvas();
});
```
Перерисовывает все канвасы при изменении размера окна.

## Основные функции color picker

### `HueSelection()`
Создает и настраивает палитру выбора цветового тона (Hue).

**Функциональность:**
- Создает горизонтальный градиент цветового спектра
- Обрабатывает перемещение кружка выбора Hue
- Вычисляет значение Hue (0-360°) на основе позиции

**Пример использования:**
```javascript
HueSelection(); // Инициализация палитры Hue
```

### `SaturationAndValueSelection(color)`
Создает и настраивает палитру выбора насыщенности и яркости.

**Параметры:**
- `color` (string) - базовый цвет для градиента насыщенности

**Функциональность:**
- Создает комбинированную палитру насыщенности (горизонтально) и яркости (вертикально)
- Обрабатывает перемещение кружка в двух измерениях
- Вычисляет значения Saturation (0-100%) и Value (0-100%)

**Пример использования:**
```javascript
SaturationAndValueSelection('rgba(255, 0, 0, 1)'); // Инициализация с красным цветом
```

### `opasityCanvas()`
Создает и настраивает палитру выбора прозрачности (Opacity).

**Функциональность:**
- Создает градиент от непрозрачного черного к прозрачному
- Обрабатывает перемещение кружка выбора прозрачности
- Вычисляет значение прозрачности (0-1) на основе позиции

**Пример использования:**
```javascript
opasityCanvas(); // Инициализация палитры прозрачности
```

## Функции конвертации цветов

### `HueToRgb(H, S, V, op)`
Конвертирует HSV значения в RGB формат.

**Параметры:**
- `H` (number) - цветовой тон (0-360)
- `S` (number) - насыщенность (0-100)
- `V` (number) - яркость (0-100)
- `op` (number) - прозрачность (0-1)

**Возвращает:**
- Array - [R, G, B, opacity] значения

**Пример:**
```javascript
const rgb = HueToRgb(180, 50, 75, 0.8); // [96, 191, 191, 0.8]
```

### `rgbToHex(rgba)`
Конвертирует RGB/RGBA цвет в HEX формат.

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- string - цвет в HEX формате (#RRGGBB)

**Пример:**
```javascript
const hex = rgbToHex('rgba(255, 128, 0, 0.5)'); // "#FF8000"
```

### `rgbToHsl(rgba)`
Конвертирует RGB/RGBA цвет в HSL формат.

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- string - цвет в HSL формате

**Пример:**
```javascript
const hsl = rgbToHsl('rgb(255, 0, 0)'); // "hsl(0, 100%, 50%)"
```

### `rgbToHsla(rgba)`
Конвертирует RGB/RGBA цвет в HSLA формат.

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- string - цвет в HSLA формате

**Пример:**
```javascript
const hsla = rgbToHsla('rgba(255, 0, 0, 0.5)'); // "hsla(0, 100%, 50%, 0.5)"
```

### `rgbTo8DigitHex(rgba)`
Конвертирует RGB/RGBA цвет в 8-значный HEX формат (с альфа-каналом).

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- string - цвет в 8-значном HEX формате (#RRGGBBAA)

**Пример:**
```javascript
const hex8 = rgbTo8DigitHex('rgba(255, 0, 0, 0.5)'); // "#FF000080"
```

### `rgbToHsvValues(rgba)`
Конвертирует RGB/RGBA цвет в HSV значения.

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- Array - [H, S, V] значения

**Пример:**
```javascript
const hsv = rgbToHsvValues('rgb(255, 0, 0)'); // [0, 100, 100]
```

### `rgbToHsv(rgba)`
Конвертирует RGB/RGBA цвет в HSV строковый формат.

**Параметры:**
- `rgba` (string) - цвет в формате RGB/RGBA

**Возвращает:**
- string - цвет в HSV формате

**Пример:**
```javascript
const hsv = rgbToHsv('rgb(255, 0, 0)'); // "hsv(0, 100%, 100%)"
```

## Функции обновления интерфейса

### `updateColorDisplay()`
Обновляет отображение текущего цвета в интерфейсе.

**Функциональность:**
- Обновляет preview цвета
- Обновляет список форматов представления
- Сохраняет состояние в VS Code storage
- Отправляет сообщение о изменении цвета

**Пример использования:**
```javascript
updateColorDisplay(); // Принудительное обновление интерфейса
```

### `updateColorFormats(color)`
Обновляет список форматов представления текущего цвета.

**Параметры:**
- `color` (string) - текущий цвет в RGBA формате

**Функциональность:**
- Генерирует представления цвета во всех поддерживаемых форматах
- Создает кликабельные элементы для каждого формата

### `updateCircalPositions()`
Обновляет позиции кружков на всех палитрах в соответствии с текущими значениями HSV.

**Функциональность:**
- Пересчитывает позиции кружков на палитрах Hue, Saturation/Value и Opacity
- Синхронизирует визуальное представление с текущими значениями

## Функции управления сохраненными цветами

### `saveColor()`
Сохраняет текущий цвет в список сохраненных цветов.

**Функциональность:**
- Получает название цвета из input поля
- Отправляет сообщение расширению для сохранения
- Очищает поле ввода

**Пример использования:**
```javascript
// Сохранение текущего цвета
saveColor();
```

### `deleteSavedColor(index)`
Удаляет сохраненный цвет по индексу.

**Параметры:**
- `index` (number) - индекс цвета в массиве сохраненных

**Пример использования:**
```javascript
// Удаление цвета с индексом 0
deleteSavedColor(0);
```

### `targetSavedColor(color)`
Устанавливает целевой цвет как текущий и обновляет все палитры.

**Параметры:**
- `color` (string) - цвет для установки в формате RGB/RGBA

**Функциональность:**
- Конвертирует RGB в HSV значения
- Обновляет глобальные переменные HSV
- Перерисовывает все палитры

**Пример использования:**
```javascript
targetSavedColor('rgb(255, 128, 0)'); // Установка оранжевого цвета
```

### `updateSavedColorsList(colors)`
Обновляет список сохраненных цветов в интерфейсе.

**Параметры:**
- `colors` (Array) - массив сохраненных цветов

**Функциональность:**
- Отображает цвета в обратном порядке (последние сверху)
- Создает элементы с preview цвета и действиями

## Вспомогательные функции

### `copyFormat(text)`
Копирует текст в буфер обмена через VS Code API.

**Параметры:**
- `text` (string) - текст для копирования

**Пример использования:**
```javascript
copyFormat('#FF5733'); // Копирование HEX значения
```

### `colorPicker(resultSetterFunction)`
Функция для обратной совместимости с внешними системами.

**Параметры:**
- `resultSetterFunction` (function) - callback функция для установки результата

## Обработчики сообщений

### Message Handler
```javascript
window.addEventListener('message', event => {
    const message = event.data;
    if (message.type === 'savedColorsUpdate') {
        updateSavedColorsList(message.colors);
    }
});
```
Обрабатывает сообщения от VS Code расширения, в частности обновления списка сохраненных цветов.